# This secret provides Cloudflare API tokens for Traefik. It allows Traefik to
# perform DNS-01 challenges and manage DNS zones when issuing TLS certificates.
# Both values are taken from `.Values.cloudflare.apiToken`, which should be
# populated by your deployment pipeline or a secret manager. Always scope
# this token to the minimum required permissions (DNS edit, zone read)
# rather than granting full account access. Rotate it regularly and treat
# it as sensitive.
apiVersion: v1
kind: Secret
metadata:
  name: traefik-cloudflare-token
  namespace: ingress
type: Opaque
stringData:
  CLOUDFLARE_DNS_API_TOKEN: {{ .Values.cloudflare.apiToken | quote }}
  CLOUDFLARE_ZONE_API_TOKEN: {{ .Values.cloudflare.apiToken | quote }}

---

# This secret contains the Zitadel master key, provided via `.Values.zitadel.masterKey`.
# The master key is used to encrypt and decrypt all sensitive data inside Zitadel.
#
# ⚠️ Important:
# - The master key is immutable by design. Zitadel uses it as the root key for
#   all encryption. If the key changes, Zitadel cannot decrypt its existing data,
#   leading to irreversible data loss.
# - Because of this, `immutable: true` is enabled at the Kubernetes level to
#   prevent accidental updates. The only way to change this secret is to delete
#   and recreate it, but doing so will render Zitadel unusable.
# - Always generate a secure, random 32-character value before the first
#   deployment and store it in a secure secret manager (Vault, SOPS, AWS Secrets
#   Manager, etc.).
#
# References:
#   https://zitadel.com/docs/self-hosting/manage/configure#masterkey
#
apiVersion: v1
kind: Secret
metadata:
  name: zitadel-masterkey
  namespace: zitadel
type: Opaque
immutable: true
stringData:
  masterkey: {{ .Values.zitadel.masterKey | quote }}

---

# This secret contains the RSA key pair for the Zitadel System API user.
# The system user enables programmatic access to the System API, which
# provides superordinate access across all Zitadel instances and organizations.
#
# The secret contains:
#   - public.pem: RSA public key used by Zitadel to verify JWTs
#   - private.pem: RSA private key used to sign JWTs (for external use)
#   - user-id: The system user identifier used in JWT claims
#
# ⚠️ Important:
# - The secret is immutable by design. Changing the keys would invalidate
#   all existing JWTs and require regenerating authentication tokens.
# - The private key grants full System API access. Store it securely and
#   rotate it periodically by recreating the secret.
# - The public key is mounted into Zitadel and referenced in SystemAPIUsers
#   configuration.
#
# References:
#   https://zitadel.com/docs/guides/integrate/zitadel-apis/access-zitadel-system-api
#
apiVersion: v1
kind: Secret
metadata:
  name: zitadel-systemuser
  namespace: zitadel
type: Opaque
immutable: true
data:
  public.pem: {{ .Values.zitadel.systemUser.publicKey | quote }}
  private.pem: {{ .Values.zitadel.systemUser.privateKey | quote }}
stringData:
  user-id: {{ .Values.zitadel.systemUser.id | quote }}
