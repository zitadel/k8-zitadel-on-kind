{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.10.7/.schema/devbox.schema.json",
  "packages": [
    "kubectl@latest",
    "kubernetes-helm@latest",
    "helmfile@latest",
    "kubernetes-helmPlugins.helm-diff@latest",
    "kind@latest",
    "grpcurl@latest"
  ],
  "env": {
    "KUBECONFIG": "${DEVBOX_PROJECT_ROOT}/.kube/config",
    "HELM_CACHE_HOME": "${DEVBOX_PROJECT_ROOT}/.helm/cache",
    "HELM_CONFIG_HOME": "${DEVBOX_PROJECT_ROOT}/.helm/config",
    "HELM_DATA_HOME": "${DEVBOX_PROJECT_ROOT}/.helm/data",
    "HELM_REPOSITORY_CACHE": "${DEVBOX_PROJECT_ROOT}/.helm/cache/repository",
    "HELM_REPOSITORY_CONFIG": "${DEVBOX_PROJECT_ROOT}/.helm/config/repositories.yaml",
    "HELM_REGISTRY_CONFIG": "${DEVBOX_PROJECT_ROOT}/.helm/config/registry/config.json",
    "HELM_COLOR": "1"
  },
  "shell": {
    "init_hook": [
      "ROOT=$(git rev-parse --show-toplevel)",
      "if [ -f \"$ROOT/.env\" ]; then set -a; source \"$ROOT/.env\"; set +a; fi",
      "export CLUSTER_NAME=$(basename \"$ROOT\")",
      "mkdir -p $(dirname $KUBECONFIG)",
      "if kind get clusters | grep -q \"^$CLUSTER_NAME$\"; then",
      "  kind get kubeconfig --name \"$CLUSTER_NAME\" > \"$KUBECONFIG\"",
      "  kubectl config use-context kind-$CLUSTER_NAME",
      "else",
      "  echo \"⚠️  Cluster '$CLUSTER_NAME' not found. Run 'devbox run reset' to create it.\"",
      "fi"
    ],
    "scripts": {
      "reset": [
        "ROOT=$(git rev-parse --show-toplevel)",
        "if [ -f \"$ROOT/.env\" ]; then set -a; source \"$ROOT/.env\"; set +a; fi",
        "export CLUSTER_NAME=$(basename \"$ROOT\")",
        "kind delete cluster --name=\"$CLUSTER_NAME\" || true",
        "kind create cluster --name=\"$CLUSTER_NAME\" --config=etc/kind.yaml",
        "mkdir -p $(dirname $KUBECONFIG)",
        "kind get kubeconfig --name \"$CLUSTER_NAME\" > \"$KUBECONFIG\""
      ]
    }
  }
}
